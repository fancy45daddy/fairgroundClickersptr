on: push

jobs:
    back:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@main
        - run: |
            sudo awk -i inplace {sub\(/#PasswordAuthentication\ yes/\,\"PasswordAuthentication\ no\"\)}1 /etc/ssh/sshd_config
            sudo systemctl restart ssh
        whoami
        mkdir ~/.ssh
        cp $(authorized_keys.secureFilePath) ~/.ssh
        curl https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz | tar -xz
        ./ngrok config add-authtoken $(ngrok)
        cat <<EOF >> ~/.config/ngrok/ngrok.yml
        tunnels:
            ssh:
                addr: 22
                proto: tcp
        EOF
        ./ngrok start ssh
